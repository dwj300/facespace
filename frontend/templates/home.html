{% extends "base.html" %}

{% block content %}
{% load thumbnail %}
<style>

body {
  background: rgb(233, 234, 237);
}

.home {
  margin-top:20px;
}

.prof_link {
  font-size: 12px;
  font-weight: bold;
  color: black;
}

.header_pic {
  float:left;
}

.post {
  margin-bottom: 10px;
  -moz-border-radius: 3px;
  border-radius:      3px;
  border-bottom-color: rgb(208, 209, 213);
  border-bottom-left-radius: 3px;
  border-bottom-right-radius: 3px;
  border-bottom-style: solid;
  border-bottom-width: 1px;
  border-image-outset: 0px;
  border-image-repeat: stretch;
  border-image-slice: 100%;
  border-image-source: none;
  border-image-width: 1;
  border-left-color: rgb(223, 224, 228);
  border-left-style: solid;
  border-left-width: 1px;
  border-right-color: rgb(223, 224, 228);
  border-right-style: solid;
  border-right-width: 1px;
  border-top-color: rgb(229, 230, 233);
  border-top-left-radius: 3px;
  border-top-right-radius: 3px;
  border-top-style: solid;
  border-top-width: 1px;
}

.post_meta {
  color: rgb(145, 151, 163);
  direction: ltr;
  display: inline;
  font-family: helvetica, arial, 'lucida grande', sans-serif;
  font-size: 12px;
  font-weight: normal;
  height: auto;
  line-height: 16.0799999237061px;
  text-align: left;
  width: auto;
  word-wrap: break-word;
  zoom: 1;
}

.upper {
  background: rgb(255, 255, 255);
  padding: 10px;
  border-bottom-color: rgb(225, 226, 227);
  border-bottom-style: solid;
  border-bottom-width: 1px;
}

.meta {
  color: rgb(20, 24, 35);
  background-color: rgb(246, 247, 248);
  font-family: helvetica, arial, 'lucida grande', sans-serif;
  font-size: 12px;
  line-height: 16.0799999237061px;
  margin-bottom: 0px;
  margin-left: 0px;
  margin-right: 0px;
  margin-top: 0px;
  padding-bottom: 0px;
  padding-left: 0px;
  padding-right: 0px;
  padding-top: 0px;
  text-align: left;
  word-wrap: break-word;
}

.lcs {
  color: rgb(145, 151, 163);
  direction: ltr;
  display: block;
  font-family: helvetica, arial, 'lucida grande', sans-serif;
  font-size: 12px;
  height: 16px;
  line-height: 16.0799999237061px;
  text-align: left;
  width: 470px;
  word-wrap: break-word;
  zoom: 1;
  margin-top:10px;


}

.lcs a {
  color: rgb(109, 132, 180);
  cursor: pointer;
  direction: ltr;
  display: inline;
  font-family: helvetica, arial, 'lucida grande', sans-serif;
  font-size: 12px;
  height: auto;
  line-height: 16.0799999237061px;
  text-align: left;
  width: auto;
  word-wrap: break-word;
  zoom: 1;
  font-weight:normal;
}

.likes {
  border-bottom-color: rgb(225, 226, 227);
  border-bottom-style: solid;
  border-bottom-width: 1px;
  color: rgb(20, 24, 35);
  font-family: helvetica, arial, 'lucida grande', sans-serif;
  font-size: 12px;

  line-height: 16.0799999237061px;
  margin-bottom: 0px;
  margin-left: 12px;
  margin-right: 12px;
  margin-top: 0px;
  padding-bottom: 7px;
  padding-left: 0px;
  padding-right: 0px;
  padding-top: 9px;
  text-align: left;
  word-wrap: break-word;
}

.likes a {
  color: rgb(59, 89, 152);
  cursor: pointer;
  direction: ltr;
  display: inline;
  font-family: helvetica, arial, 'lucida grande', sans-serif;
  font-size: 12px;
  height: auto;
  line-height: 16.0799999237061px;
  list-style-type: none;
  text-align: left;
  text-decoration: none;
  unicode-bidi: embed;
  width: auto;
  word-wrap: break-word;
  zoom: 1;
}

.comment_town {
  border-bottom-left-radius: 2px;
  border-bottom-right-radius: 2px;
  border-top-left-radius: 0px;
  border-top-right-radius: 0px;
  color: rgb(20, 24, 35);
  font-family: helvetica, arial, 'lucida grande', sans-serif;
  font-size: 12px;
  line-height: 16.0799999237061px;
  margin-bottom: 0px;
  margin-left: 12px;
  margin-right: 12px;
  margin-top: 0px;
  padding-bottom: 0px;
  padding-left: 0px;
  padding-right: 0px;
  padding-top: 8px;
  text-align: left;
  word-wrap: break-word;
  
}

.comment {
  padding-bottom: 4px;

}

.comment_pic {
  float: left;;
}

.comment_meta {
  color: rgb(145, 151, 163);

  font-family: helvetica, arial, 'lucida grande', sans-serif;
  font-size: 12px;
  font-weight: normal;
  height: auto;
  line-height: 16.0799999237061px;
  list-style-image: none;
  list-style-position: outside;
  list-style-type: none;
  text-align: left;
  word-wrap: break-word;
  zoom: 1;
}

.comment_meta a {
  color: rgb(59, 89, 152);

  display: inline;
  font-family: helvetica, arial, 'lucida grande', sans-serif;
  font-size: 12px;
  font-weight: normal;
  height: auto;
  line-height: 16.0799999237061px;
  list-style-image: none;
  list-style-position: outside;
  list-style-type: none;
  text-align: left;

  width: auto;
  word-wrap: break-word;
  zoom: 1;
}

.new_comment_box {
  min-height: 44px; 
  padding-top: 4px;
}

.new_comment_text {
  width:682px;
  min-height:30px;
}

.mini_prof_pic {
  margin-right:8px;
  margin-top:0px;
  vertical-align: top;
}

.post_prof_pic {
  margin-right:8px;
  margin-top:0px;
  vertical-align: top;
}

.header .prof_link {
  color:rgb(59, 89, 152);
  font-weight: bold;
  font-size:14px;
}

.comment_box .prof_link {
  color:rgb(59, 89, 152);
  font-weight: bold;
  font-size:12px;
}

.post .body {
  margin:10px;
  margin-left:0px;
  margin-bottom:0px;
}

.post .body {
  font-family: helvetica, arial, 'lucida grande', sans-serif;
}


</style>

<div class="home row">
  <div class="left-margin col-xs-2"></div>

  <div class="sidebar col-xs-2">
    <a href="{% url 'profile' user.username %}">
      {% thumbnail user.profile_picture.image "40x40" crop="center" as im %}
        <img class="mini_prof_pic" src="{{ im.url }}" width="{{ im.width }}" height="{{ im.height }}">
      {% endthumbnail %}
    </a>
    <a class="prof_link" href="{% url 'profile' user.username %}">{{ user }}</a>
  </div>

  <div class="feed col-xs-8" id="feed">

    {% for s in statuses %}
    <div class="post">
      <div class="upper">
        <div class="header">
          <div class="header_pic">
            <a href="{% url 'profile' s.user.username %}">
              {% thumbnail s.user.profile_picture.image "40x40" crop="center" as im %}
                <img class="post_prof_pic" src="{{ im.url }}" width="{{ im.width }}" height="{{ im.height }}">
              {% endthumbnail %}
            </a>
          </div>
          <a href="{% url 'profile' s.user.username %}" class="prof_link">{{ s.user }}</a>
          <br>
          <span class="post_meta">5 hrs</span>
        </div>
        <div class="body">
          <div class="text">{{ s.text }}</div>
          <div class="lcs"><a>Like</a> · <a>Comment</a></div>
        </div>
      </div>
      <div class="meta">
        <div class="likes">
          <a><span class="glyphicon glyphicon-thumbs-up"></span></a> <a href="" class="">5 people</a> like this.
        </div>
        <div class="comment_town">
          <div class="comments">

            <div class="comment">
              <div class="comment_pic">
                {% thumbnail s.user.profile_picture.image "32x32" crop="center" as im %}
                  <img class="mini_prof_pic" src="{{ im.url }}" width="{{ im.width }}" height="{{ im.height }}">
                {% endthumbnail %}
              </div>
              <div class="comment_box">
                <a href="{% url 'profile' s.user.username %}" class="prof_link">{{ s.user }}</a>
                This is the comment itself.
                <div class="comment_meta">
                  <span>55 mins</span>
                </div>
              </div>
            </div>

            <div class="comment">
              <div class="comment_pic">
                {% thumbnail user.profile_picture.image "32x32" crop="center" as im %}
                  <img class="mini_prof_pic" src="{{ im.url }}" width="{{ im.width }}" height="{{ im.height }}">
                {% endthumbnail %}
              </div>
              <div class="comment_box">
                <a href="{% url 'profile' user.username %}" class="prof_link">{{ user }}</a>
                This is another comment.
                <div class="comment_meta">
                  <span>40 mins</span>
                </div>
              </div>
            </div>

            <div class="comment">
              <div class="comment_pic">
                {% thumbnail s.user.profile_picture.image "32x32" crop="center" as im %}
                  <img class="mini_prof_pic" src="{{ im.url }}" width="{{ im.width }}" height="{{ im.height }}">
                {% endthumbnail %}
              </div>
              <div class="comment_box">
                <a href="{% url 'profile' s.user.username %}" class="prof_link">{{ s.user }}</a>
                This is the last comment.
                <div class="comment_meta">
                  <span>5 mins</span>
                </div>
              </div>
            </div>

          </div>
          <div class="new_comment_box">
              <div class="comment_pic">
                {% thumbnail user.profile_picture.image "32x32" crop="center" as im %}
                  <img class="mini_prof_pic" src="{{ im.url }}" width="{{ im.width }}" height="{{ im.height }}">
                {% endthumbnail %}
              </div>
              <div class="new_comment_text_box">
                <form action="" method="POST">
                  <input class="new_comment_text" type="text" name="comment" placeholder=" Write a comment...">
                </form>
              </div>
          </div>

        </div>
      </div>
    </div>
    {% endfor %}

  </div>

  <div class="right-margin col-xs-2"></div>
</div>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script> 
<script>

$(document).ready(function(){
  console.log('hi');

  $.getJSON('../api/', {action: 'newsfeed_list'}).
    done(function(data){
      console.log(data);
      if(data.posts.length == 0)
      {
        console.log('your friends suck');
      }
      else
      {
        $.each(data.posts, function(i, p){
          console.log('top');
          console.log(p.likes.length);
          console.log('mid');
          console.log(p.dislikes.length);
          console.log('bottom');
           
          html =  '<div class="post" id="post_' + p.post_id + '">' +
                    '<div class="upper">' +
                      '<div class="header">' +
                        '<div class="header_pic">' +
                          '<a href="./profile/' + p.user_name + '/">' +
                              '<img class="post_prof_pic" src="??" width="40" height="40"> <!--todo-->' +
                          '</a>' +
                        '</div>' +
                        '<a href="./profile/' + p.user_name + '/" class="prof_link">' + p.full_name + '</a>' +
                        '<br>' +
                        '<span class="post_meta">' + p.age + '</span>' +
                      '</div>' +
                      '<div class="body">' +
                        '<div class="text">' + p.text + '</div>' +
                        '<div class="lcs">' +
                          '<a href="">' + (p.liked == 0 ? 'Like' : 'Unlike') + '</a> · <a href="">' + (p.disliked == 0 ? 'Dislike' : 'Undislike') + '</a> · <a>Comment</a>' +
                        '</div>' +
                      '</div>' +
                    '</div>' +
                    '<div class="meta">' +
                      '<div class="likes">' +
                        '<a><span class="glyphicon glyphicon-thumbs-up"></span></a> <a href="" class="">' + (p.likes.length - p.dislikes.length) + ' people</a> like this.' +
                      '</div>' +
                      '<div class="comment_town">' +
                        '<div class="comments" id="comments_' + p.post_id + '">' +

                        '</div>' +
                        '<div class="new_comment_box">' +
                            '<div class="comment_pic">' +
                                '<img class="mini_prof_pic" src="??" width="32" height="32"><!--todo-->' +
                            '</div>' +
                            '<div class="new_comment_text_box">' +
                              '<form action="">' +
                                '<input class="new_comment_text" type="text" name="comment" placeholder=" Write a comment...">' +
                              '</form>' +
                            '</div>' +
                        '</div>' +

                      '</div>' +
                    '</div>' +
                  '</div>';
          console.log(html);
          $('#feed').append(html);

          console.log('hi');

          $.each(p.comments, function(j, c){
            console.log('hii');
            comm_html = '<div class="comment">' +
                          '<div class="comment_pic">' +
                              '<img class="mini_prof_pic" src="??" width="32" height="32">' +
                          '</div>' +
                          '<div class="comment_box">' +
                            '<a href="./profile/' + c.user_name + '/" class="prof_link">' + c.user_full_name + '</a> ' +
                            c.text +
                            '<div class="comment_meta">' +
                              '<span>' + c.age + '</span>' +
                            '</div>' +
                          '</div>' +
                        '</div>';
            console.log('hiii');                        
            $('#comments_' + p.post_id).append(comm_html);
            console.log('hiiii');
          });

        });
      }
    });
});

</script>
{% endblock %}